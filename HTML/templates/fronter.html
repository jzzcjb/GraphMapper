<!DOCTYPE html>
<html>
<head>
    <!-- <link rel="stylesheet" href="/HTML/static/css/fronter.css"/> -->
    <meta charset="UTF-8">
    <title>GraphMapper</title>
    <style>
body {
    margin: 0;
    padding: 0;
    display: flex;
    flex-direction: column;
    justify-content: center;
    align-items: center;
}

.top {
    top: 0;
    left: 0;
    width: 100%;
    height: 40vh;
    position: fixed;
    display: flex;
    flex-direction: column;
    justify-content: center;
    align-items: center;
    background-color: rgb(63, 72, 204);
    color: white;
    transition: transform 0.2s;
    transform: translateX(0%);
}
.bottom {
    height: auto;
    width: 100vw;
    display: flex;
}
.sidebar {
    width: 18vw;
    background-color: #ffffff;
    float:left;
    border-width:1.5px;
    border-right-style: solid;
    border-color:  rgba(173, 173, 173, 0.508);
}
.sidebar-key-item {
    width: 18vw;
    height: 20vh;
    background-color: rgba(255, 255, 255, 0.75);
    display: flex;
    margin-top: 1px;
    flex-direction: row;
    justify-content: center;
    align-items: center;
    font-size: 1.5vw;
    color: rgb(63, 72, 224, 0.75);
    text-decoration: none;
}
.sidebar-key-item:hover {
    transform: translateY(-2px);
}
.sidebar-item {
    width: 18vw;
    height: 20vh;
    background-color: rgba(255, 255, 255, 0.75);
    display: flex;
    margin-top: 1px;
    flex-direction: row;
    justify-content: center;
    align-items: center;
    font-size: 1.5vw;
    color: rgba(144, 148, 216, 0.75);
    text-decoration: none;
}
.sidebar-item:hover {
    transform: translateY(-2px);
}
.step-key-index {
    width: 6vw;
    height: 4vh;
    border: 3px solid rgba(63, 71, 224, 0.85);
    border-radius: 999px;
    float:left;
    display: flex;
    flex-direction: row;
    justify-content: center;
    align-items: center;
    font-size: 2vw;
    margin-right: 1vw;
}
.step-index {
    width: 6vw;
    height: 4vh;
    border: 3px solid rgba(144, 148, 216, 0.75);
    border-radius: 999px;
    float:left;
    display: flex;
    flex-direction: row;
    justify-content: center;
    align-items: center;
    font-size: 2vw;
    margin-right: 1vw;
}
.step-connection {
    height: 15.3vh; 
    width: 3px; 
    background-color: rgba(144, 148, 216, 0.75); 
    margin-left: 6.5vw; 
    margin-top: -27.8vh;
}
h1 {
    font-size: calc(6vw + 12px);
    font-family: '华文新魏';
    margin-bottom: 10px;
    transition: transform 0.2s;
    transform: translateX(0%);
}

h2 {
    font-size: calc(1.5vw + 9px);
    font-family: '华文新魏';
    margin-bottom: 0;
    transition: transform 0.2s;
    transform: translateX(0%);
}

.main-body {
    /* margin-top: 50vh; */
    background-color: rgb(250, 250, 250);
    height: 100vh;
    width: 80vw;
    display: flex;
    justify-content: center;
    align-items: center;
    flex-direction: column;
    float:left;
    /* position: relative; */
}

.image {
    /* position: absolute; */
    width: 100vw;
    height: auto;
    transform: translate(0,-100%);
    opacity: 0.7;
}
.upload-input {
    display: none;
}

.message {
    margin-top: calc(2vw + 10px);
    font-size: calc(0.8vw + 8px);
    font-weight: bold;
    color: rgb(63, 72, 204);
    text-align: center;
    font-family:Verdana, Geneva, Tahoma, sans-serif;
}
.buttons {
    display: flex;
    margin-top: 1px;
    flex-direction: row;
    justify-content: center;
    align-items: center;
}
.upload-button {
    /* padding: 1.7vw 3.5vw; */
    height: 40px;
    width: 100px;
    border: 2px solid rgb(63, 72, 204);
    font-size: 16px;
    margin-left: 1vw;
    margin-right: 1vw;
    color: rgb(63, 72, 204);
    border-radius: 10px;
    background-color: rgb(255, 255, 255);
    text-align: center;
    display: flex;
    justify-content: center;
    align-items: center;
    flex-direction: column;
    cursor: pointer;
    font-family: Verdana, Geneva, Tahoma, sans-serif;
    text-decoration: none;
}
.upload-button:hover {
    box-shadow: 0 2px 6px rgba(63, 72, 204, 0.4);
}
/* 整体盒子 */
.drop-main {
    width: 40vw;
    height: calc(40vh+2px);
    overflow: hidden;
    /* position: relative; */
    margin: 5vh auto;
    background: #f7f6f6;
    
}
/* 文件上传盒子 */
.drop-box {
    width: calc(40vw-2px);
    height: 40vh;
    border: 1px dashed #a89b9b;
    overflow: hidden;
    overflow-y: auto;
    display: flex;
    justify-content: center;
    align-items: center;
    flex-direction: column;
}
/*滚动条样式*/
.drop-box::-webkit-scrollbar {
    width: 4px;    
}
.drop-box::-webkit-scrollbar-thumb {
    border-radius: 10px;
    -webkit-box-shadow: inset 0 0 5px rgba(0,0,0,0.2);
    background: rgba(0,0,0,0.2);
}
.drop-box::-webkit-scrollbar-track {
    -webkit-box-shadow: inset 0 0 5px rgba(0,0,0,0.2);
    border-radius: 0;
    background: rgba(0,0,0,0.1);
}
/* 单个文件 */
.drop-box > div {
    width: 144px;
    height: 170px;
    margin: 1px 3px;
    display: inline-block;
    position: relative;
}
/* 缩略图 */
.drop-box > div > img {
    width: 100%;
    height: 145px;
}
/* 删除按钮 */
.drop-box > div > div {
    position: absolute;
    right: 5px;
    top: 5px;
    width: 20px;
    height: 20px;
    background: red;
    color: white;
    border-radius: 50%;
    text-align: center;
    line-height: 18px;
    /* font-weight: bold; */
    font-size: 25px;
    cursor: pointer;
}
/* 文件名 */
.drop-box > div > p {
    text-align: center;
    width: 100%;
    height: 25px;
    line-height: 25px;
    overflow: hidden;
    text-overflow: ellipsis;
    white-space: nowrap;
}
/* 提示文字 */
.drop-text {
    /* position: absolute; */
    width: 450px;
    height: 50px;
    top: 200px;
    text-align: center;
    line-height: 50px;
    opacity: 0.3;
}
/* 点击上传字体 */
.drop-text > span {
    color: #347aa5;
    cursor: pointer;
}
        .intro {
            width: 50vw;
            margin: 5vh 0vh 0vh 0vh;
            background-color: #ffc9657b;
            border: 3px solid rgb(237, 173, 95);
            color: #5d3e09;
            padding-left: 2vw;
            padding-right: 2vw;
            /* text-align: center; */
            /* position: absolute; */
			border-radius: 1vw;
        }


    </style>
</head>
<body>
    <div id="top" class="top">
        <h1 id="title">GraphMapper</h1>
        <h2 id="subtitle">A Professional and Considerate Security Insurance Pricing System</h2>
        
    </div>
    <div style="height: 40vh;"></div>
    <div class="bottom">
        <div class="sidebar">
            <div style="height: 10vh;"></div>
            <a href="{{ url_for('main') }}" class="sidebar-key-item ">
                <div class="step-key-index">step1</div>
                <div style="float:left">
                    <p>首 页</p>
                </div>
            </a>
            <a href="{{ url_for('result') }}" class="sidebar-item ">
                <div class="step-index">step2</div>
                <div style="float:left">
                    <p>结 果</p>
                </div>
            </a>
            <!-- <div class="step-connection"></div> -->
            <a href="{{ url_for('analyse') }}" class="sidebar-item ">
                <div class="step-index">step3</div>
                <div style="float:left">
                    <p>详 情</p>
                </div>
            </a>
            <!-- <div class="step-connection"></div> -->
        </div>
        <div class="main-body">
            <div class="intro">
                <p style="font-size: large;"><b>解决方案</b></p>
                <p style="font-size: small;">1. <b>上传</b>系统信息以及网络拓扑结构</p>
                <p style="font-size: small;">2. <b>查看</b>基于防御优化决策的成本分析，风险指标的计算保费结果</p>
                <p style="font-size: small;">2. 网络特征的<b>详细</b>特性以及脆弱点建议。</p>
            </div>
            
            <div class="drop-main">
                <div id="drop" class="drop-box">
                    <p class="drop-text">Drag and drop files here/
                        <span id="fileinput2" onclick="upload()">Click to upload file</span>
                    </p>
                </div>
            </div>
            <div class="buttons">
                <!-- <img src="/HTML/static/infig.png" class="image"> -->
                <form id="upload-form" action="" method="POST" enctype="multipart/form-data">
                    <input type="file" name="file" id="file-input" class="upload-input">
                    <label for="file-input" class="upload-button">上传文件</label>
                </form>
                <!-- <div id="message" class="message">点击下方按钮查看结果</div> -->
                <a href="{{ url_for('result') }}" class="upload-button ">查看结果</a>
            </div>
            
            
                <!-- <div class="button-group">
                    <button id="button1" class="custom-button">Button 1</button>
                    <button id="button2" class="custom-button">Button 2</button>
                    <button id="button3" class="custom-button">Button 3</button>
                </div> -->
            <!-- <div id="image-container" class="image-container"></div> -->
        </div>
    </div>
    

    <script src="https://mozilla.github.io/pdf.js/build/pdf.js"></script>
    <script>
        // 获取dom元素
        let droptarget = document.getElementById("drop")
        // 文件流数组
        let fileBlodArr = []
        // 文件数组
        let fileArr = []
        // 拖拽上传事件
        function handleEvent(event) {
            
            // 阻止事件的默认行为
            event.preventDefault();
            if (event.type === 'drop') {
                // 文件进入并松开鼠标,文件边框恢复正常
                droptarget.style.borderColor = '#a89b9b'
                for (let file of event.dataTransfer.files) {
                    // 把文件保存到文件数组中
                    fileArr.push(file)
                    // 初始化文件
                    filesToBlod(file)
                }
            } else if (event.type === 'dragleave') {
                // 离开时边框恢复
                droptarget.style.borderColor = '#a89b9b'
            } else {
                // 进入边框变为蓝色
                droptarget.style.borderColor = 'blue'
            }
        }
        // 拖拽事件绑定
        droptarget.addEventListener("dragenter", handleEvent);
        droptarget.addEventListener("dragover", handleEvent);
        droptarget.addEventListener("drop", handleEvent);
        droptarget.addEventListener("dragleave", handleEvent);

        // var mySpan = document.getElementById("mySpan");
        // mySpan.addEventListener("click", function() {
        //     alert("你点击了这个 span 元素");
        // });
        // 获取input元素
        // let fileInput = document.getElementById('fileinput2')
        // // 通过input框上传文件
        // fileInput.addEventListener("click", (event) => {
        //     // 上传的文件都会保存到文件数组中
        //     document.getElementById('message').textContent = "click";
        //     fileArr.push(event.target.files[0])
        //     filesToBlod(event.target.files[0])
        // })
        // 点击上传-单击事件-通过js触发input事件
        // function upload() {
        //     document.getElementById('message').textContent = "click";
        //     fileInput.click()
        // }

        // 文件处理函数
        function filesToBlod(file) {
            // 创建文件对象
            reader = new FileReader()
            // 文件转为文件流
            reader.readAsDataURL(file)
            // 文件读取完成，根据类型不同显示不同的图标
            reader.onload = e => {
                // 把文件流放入文件流数组中
                fileBlodArr.push(e.target.result)
                // 创建单个文件预览
                let fileDiv = document.createElement('div')
                // 删除按钮
                let removeDiv = document.createElement('div')
                removeDiv.id = 'file' + '-' + fileBlodArr.length
                removeDiv.innerHTML = '×'
                // 文件名
                let fileName = document.createElement('p')
                fileName.innerHTML = file.name
                fileName.title = file.name
                fileName.style.padding = 0;
                fileName.style.margin = 0;
                // 缩略图-图片直接展示,其他文件根据文件类型展示不同的缩略图
                let img = document.createElement('img')
                if (/image/.test(file.type)) {
                    img.src = e.target.result
                } else {
                    switch(file.type) {
                    case 'application/msword' :
                        img.src = './static/image/word.png'
                        break
                    case 'application/vnd.openxmlformats-officedocument.wordprocessingml.document' :
                        img.src = './static/image/word.png'
                        break
                    case 'application/vnd.ms-powerpoint': 
                        img.src = './static/image/ppt.png'
                        break
                    case 'application/vnd.openxmlformats-officedocument.presentationml.presentation': 
                        img.src = './static/image/ppt.png'
                        break
                    case 'application/vnd.ms-excel': 
                        img.src = './static/image/excel.png'
                        break
                    case 'application/vnd.openxmlformats-officedocument.spreadsheetml.sheet': 
                        img.src = './static/image/excel.png'
                        break
                    case 'application/pdf':
                        img.src = './static/image/pdf.png'
                        break
                    case 'text/plain':
                        img.src = './static/image/txt.png'
                        break
                    case 'text/javascript':
                        img.src = './static/image/js.png'
                        break
                    case 'text/html':
                        img.src = './static/image/html.png'
                    case 'text/css':
                        img.src = './static/image/css.png'
                        break
                    default: 
                        img.src = './static/image/other.png'
                    }
                }
                // 组合单个文件并放入dom中
                fileDiv.appendChild(img)
                fileDiv.appendChild(removeDiv)
                fileDiv.appendChild(fileName)
                droptarget.appendChild(fileDiv)
            }
            // 文件读取失败的提示
            reader.onerror = () => {
            switch(reader.error.code) {
                case '1':
                alert('未找到文件')
                break
                case '2':
                alert('安全错误')
                break
                case '3':
                alert('读取被中断')
                break
                case '4':
                alert('文件不可读')
                break
                case '5':
                alert('编码错误')
                break
                default: 
                alert('文件读取失败')
            }
            }
            // 文件读取的进度，因为是本地读取所以进度很快，基本看不出来，所以选择打印查看
            reader.onprogress = event => {
            console.log(`${event.loaded}/${event.total}`)
            }
        }

        // 删除文件操作
        droptarget.addEventListener('click', event => {
            if (event.target.id.indexOf('file-') > -1) {
                // 清空整个文件上传盒子
                droptarget.innerHTML = ''
                // 删除文件数组中对应的数据
                fileArr.splice(event.target.id.split('-')[1] - 1, 1)
                // 清空文件流数组
                fileBlodArr = []
                // 重新生成文件上传盒子
                fileArr.map(item => {
                    filesToBlod(item)
                })
            }
        })
    </script>
    <script src="static/js/scrolling.js"></script>
    <script src="/HTML/static/js/scrolling.js"></script>
</body>
</html>
